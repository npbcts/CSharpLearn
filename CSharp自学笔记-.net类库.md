## C# 自我初学笔记 第N单元  调用.NET类库

来源于: [Learn C# 初级自学教程](https://learn.microsoft.com/zh-cn/training/modules/csharp-call-methods/2-dotnet-class-library),微软推出的初学者教程整理。


### 什么是 .NET 类库？

除了 C# 语言本身，还需要其他项才能构建应用程序。这些被C#调用的项，构成了类库。主要用于以下两个方面：
- 程序底层: .NET 运行时，用于在最终用户的计算机上执行代码时托管并管理代码
- 已写通用功能： 可依赖于可在应用程序中使用的称为 .NET 类库的功能集合

.Net 类库是包含成千上万个方法的数以千计的类的集合。 这些方法由 Microsoft 创建，并可在应用程序中使用。

类只是一种用于包含方法的容器。 开发者通常将相关方法保留在一个类中。 例如，可从命令行窗口发送或接收信息的任何方法都会被收集到 .NET 类库的 System.Console 类中。

### 主要类库分类：

- 包含类和方法的一个较大子集创建动态 Web 应用程序。 
- 还存在好几个系列的类，使你能够构建本机桌面应用程序。 
- 可使用另一个类和方法的子集访问数据库。
- 还有其他一些类，其方法本质上更适用于常规用途。 
- 甚至数据类型也是 .NET 类库的一部分,为简化我们的工作，C# 掩盖了我们使用的数据类型的真实标识。

换言之，其实用工具跨不同的框架。 如果希望读取或写入文件、执行三角函数或微积分操作、进行调用以从 Internet 中检索数据，无论是要构建 Web、桌面、移动还是要构建云应用程序，都可使用这些类及其方法。

### 命名空间 -> 类库的名字

 类被组织成不同的命名空间，以防发生命名冲突。可将命名空间视为类型的“姓氏”。 类包含实现类型的代码。

### 查找类库  

.NET类库如此庞大，以至于任何人都不了解所有部分，即使是在 Microsoft 工作的人员也不了解。那么，如何找到应用程序所需的内容呢？  

- 根据所处理的项目，你会更熟悉 .NET 类库的某些部分
- 搜索引擎查找博客文章、文章或论坛
- 阅读 Microsoft 关于特定方法的文档

在进入不熟悉的领域时，所有软件开发者都遵循类似的过程。 发现的过程虽然充满挑战，但却是令人愉快的。

### 调用 .NET 类库中的方法

```c#
// System库中的 Random 类和 Console 类的方法
Random dice = new Random();  // Random类对象的实例化
int roll = dice.Next(1,7);  // 调用 dice 对象的 Next() 方法，传入两个参数：随机数字的最小值和最大值。
Console.WriteLine(roll);  // 打印roll
```
输出1~7之间的随机数。

### 有状态方法与无状态方法(或叫实例方法，静态方法)
两者之间的区别:
- 有状态方法: 需要将某个类实例化，针对实例化后的类执行方法。因此这个类可以有多个实例执行相同的方法。原因在于，有状态方法依赖存储在内存中的值,实例化后的类包含这个值。  
    例如`Random`类，依赖内存中的参数(本例为1-7)，去创建随机数。需要创建`Random`实例存储参数值。
- 无状态方法：无需将类实例化。原因在于，执行特定的功能，不需要包含或以来内存中的值。  
    例如`Console.Write()`方法，只执行打印动作，无依赖值。

### 如何确定是否需要创建实例

- 一种了解方法调用方式的方法是参考文档。 可通过其中的一些示例了解是必须从对象实例调用方法，还是必须直接从类调用方法。文档中会有如下说明:  
    实例方法(virtual)：  
    ```c#
    public virtual int Next ();
    ```
    静态方法(static)：  
    ```c#
    public static IntPtr Max (IntPtr val1, IntPtr val2);
    ```
- 或者，也可以尝试直接从类本身访问该方法。 可能出现的最糟糕的情况是遇到编译错误。

```c#
int result = Random.Next();
```
将显示一条红色波浪线，指示发生编译错误。 将**鼠标游标悬停在红色波浪线上**，会出现一个弹出窗口，其中显示以下消息：
```
(1,14): error CS0120: An object reference is required for the non-static field, method, or property 'Random.Next()'
```
即在编译器中测试看是否正确，编译器会针对输入情况进行提示。

### 类库的参数 和 重载的方法

使用数据类型定义输入参数。 不能将不同数据类型的值作为输入参数传递，并要求方法正常工作。 相反，C# 编译器将捕获错误，并在编译和运行代码之前强制进行代码修改。 类型检查是 C# 和 .NET 用户检查数据类型来防止最终用户遇到异常的一种方法。

**方法签名**是为每个输入参数定义的输入参数的数目和数据类型。


重载方法是通过**多个方法签名**定义的。 重载方法提供**不同的方式调用方法，或提供不同类型的数据**。

例如，Console.WriteLine() 方法具有 19 个不同的重载版本。 其中的大多数重载都允许将不同类型的打印数据发送到控制台。 请考虑以下代码：
```c#
int number = 7;
string text = "seven";

Console.WriteLine(number);
Console.WriteLine();
Console.WriteLine(text);
```
在此示例中，将调用 WriteLine() 方法的三个单独的重载版本。


### 了解重载方法的途径

#### 使用 IntelliSense

首先，代码编辑器的 Intellisense 可在不离开编码环境的情况下告知有关方法的很多信息。 Intellisense 是 Microsoft 为代码编辑器提供的一项功能。 输入代码时，在插入点下的弹出窗口中提供提示和简短的参考信息。 键入代码时，Intellisense 弹出窗口会根据上下文更改其内容。

例如，缓慢输入字词 dice 时，Intellisense 显示所有 C# 关键字、标识符（或者是代码中的变量名称），以及 .NET 类库中与输入的字母匹配的类。 代码编辑器的自动完成功能可键入 Intellisense 弹出窗口中最匹配的字词。

若要体验 Intellisense，请依次输入字母 d、i、c。 Intellisense 弹出时，应显示 dice 标识符。 在键盘上选择 tab 键，即可完成整个字词。 还可使用向上键和向下键更改选择。

接下来，输入成员访问运算符。 Intellisense 弹出窗口再次出现，并显示所有可用的方法（以及类的其他成员）。 如果输入字母 N，则筛选此列表，且字词 Next 应为优先选项。 同样，在键盘上选择 tab 键，即可自动完成整个字词。

接下来，输入左括号。 会自动添加右括号。

更重要的是，Intellisense 弹出窗口中会显示两个区域。 在右侧，应看到 int Random.Next()。 int 为返回类型。 换言之，执行此版本的方法时，会返回 int 类型的值。

在 Intellisense 弹出窗口的左侧，显示 1/3，指示现在显示的是 Next() 方法的第一个版本，该版本不接受输入参数。 在 1/3 上方和下方还有一个小箭头。 选择键盘的向上键和向下键，即可导航到该方法的第二个和第三个重载版本。 执行此操作时，2/3 和 3/3 会分别显示在 Intellisense 的左侧。

方法的第二个重载版本 2/3 告知你 Next() 方法可以接受输入参数 int maxValue。 该方法的第三个版本 3/3 告知你 Next() 方法可以接受 int minValue 和 int maxValue 作为输入参数。

什么是 maxValue 和 minValue？ 通常，可通过参数名称得出参数含义。 但是，如果其含义不明显，我们可能需要查阅方法的文档。 在这种情况下，maxValue 是最大值，或 Next() 方法生成数字的“上限”。 minValue 是最小值，或 Next() 方法生成数字的“下限”。

#### 查看文档

有关重载方法的信息，请使用 docs.microsoft.com

首先，使用搜索引擎，并搜索类名称和方法名称。 可能还要包括术语 C#，确保不会意外地得到其他编程语言的结果。 在这种情况下，请尝试搜索：C# Random.Next()。

其中一个搜索结果应将你指向以 https://docs.microsoft.com 开头的 URL。 在我们的示例中，链接的标题应显示为“Random.Next 方法（系统）| Microsoft Docs”。

如果在使用搜索引擎进行查找时遇到问题，请参阅以下链接：

Random.Next 方法（系统）| Microsoft Docs

文档遵循 .NET 类库中的每个类和方法的标准格式。

在网页顶部附近，可看到名为“重载”的部分。 此处列出了该方法的三个版本，并提供了链接到具体页面的超链接。 选择 Next(Int32) 链接，并查看有关方法的特定重载版本的文档。